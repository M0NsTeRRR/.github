---
# THIS FILE IS GENERATED! DO NOT EDIT! Maintained by Pulumi
# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
{%- set included_content -%}
{%- if package %}
{%- include "workflow/{}/package.yml.j2".format(language) %}
{%- endif %}
{%- if docker %}
{%- include "workflow/docker.yml.j2" -%}
{%- endif %}
{%- endset -%}
{%- set needs %}
{%- if package %}
{%- if language == "python" %}, publish-package{%- elif language == "go" %}, publish-binary{% endif -%}
{% endif -%}
{%- if docker %}, docker-sign{% endif -%}
{%- endset %}
name: {{ language }} release
on:
  push:
    tags:
      - '*'
permissions: {}
jobs:
{%- if changelog %}
{%- set included_template %}
{%- include "workflow/changelog/main.yml.j2" %}
{%- endset %}
{{- included_template | indent(2) }}
{%- endif %}
  create-draft-release:
    name: Create release as draft
    runs-on: ubuntu-latest
    permissions:
      contents: write
    {%- if changelog %}
    needs: [changelog]
    {% endif -%}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Create release as draft
        run: gh release create {{ "${{" }} github.ref_name {{ "}}" }}{%- if changelog %} -n "{{ "${{" }} needs.changelog.outputs.release_body {{ "}}" }}"{% endif %} --draft
        env:
          GITHUB_TOKEN: {{ " ${{" }} secrets.GITHUB_TOKEN {{ " }}" }}
{{- included_content | indent(2) }}
  publish_release:
    name: Publish release
    runs-on: ubuntu-latest
    permissions:
      contents: write
    needs: [create-draft-release{{ needs }}]
{%- raw %}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Create release
        run: gh release edit ${{ github.ref_name }} --draft=false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
{% endraw %}